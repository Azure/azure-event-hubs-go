language: go
sudo: false
go:
  - 1.x
  - 1.11.x
before_install:
  - cd ${TRAVIS_HOME}
  - go get github.com/mattn/goveralls
  - go get golang.org/x/tools/cmd/cover
  - go get github.com/fzipp/gocyclo
  - go get golang.org/x/lint/golint
  - cd ${TRAVIS_BUILD_DIR}
jobs:
  include:
  - stage: integration tests
    if: type IN (push, cron)
    env:
      - secure: epA3y311AWEIyCYnap2c9weBnnKw8y5i12ETD/OrvYQxrDeFKf+Y8knKtUYxTWa60qGVy04jeO1DNPJHEezU3cwn9FQK/8Gply8Aoh8/OdD/gMjGNRKsJR/bPcbVj9RvfEoX/gzlgTydgC2/o7cUlEUZPx0NbiTqhGbozYMe7ET+3bElsbkPtVl7oBucUohtHK+AlK6RHYQjp1Rps8DXj0JptjxNLdWu6yRNFd5MzLWpIHVtpcwbAbK9PqQ2Mh7pKiwRUrdfUN9d+voOSZmZs6xyw3WmjN6YWp34k+53ebxE3dxEJlbo3NYdNB+BgmzS7TMIezm6AEYxAhsNGabf/b+KMmcncwuAc9XEJ2TTdWbFXygHPzNMB6awBeFQRM2BCgBN5oTu+RDaQDyx+gswd8sV6jittKZkCPZHBxWH8Y8AmLUKdaZO+WD9dPN44g2hlbNBshPdTORvQvOjH6yhbJsHs/CZn1va9D+LwL+H3IBl1ZY413gja1UqoSoQSCU0wWbKQSHG4ZxLzYqC27Xrcc+tLZD9fyJHUlqlcwR8OLnrno+WsuetxeIIxuJuXrCO6boYMFpgAlJfulMG0tXPSptVXVDhh3RsnK23MYke05RyuRnH3dGpyOJRNjjPYCdagmJPp+XPB2LrlUEhU0zFMxBJXIwhuBAUttx/mNpgRVA=
      - secure: iJhPsOMf7UaNQE0bFwWya8kAPwPAoO5tra0jtWEBnME50AJmIP9oLHYDCdMwC8wQb+DqiTNz/auLFtcLt6yqKv+QEu6Ikw0jyaYFVi2bSfmUn6dbQ2Wqd8a4+uVcWNRcAB7eiurn0A8/DhPH/7AVPJlh+kxoX92FusfX3ZCdu29gnu7t9j2YndeY/rXSLwLKkbY2ympt/Vk7rLPjTKVTNK/XMrtSrmWq3wlpYzx498bcefcn1YpgovAeu85nlot6TkgrshYKUMLjxhb10lPhgUCgaW1gnELuem9i3zP8aV3GiP/wlPvtJ+Ts2Ciqn4PTvzVM/ZpFCxJnhLExrQwnVCdcV4jVUhFmrnbgczaPkzWFgNTl/dl32SIxbA5cjW+SJt7F+UkpdBMHWz59zVrTmYrkpIE9W82PS27mkCXdNkPjO03zjXcFb4IvePbIGuCgqhgcHdq1V6TOX5Mw7yFEP8r+jVDJp7xYB3yc3e6gsGNF3fjFC9jASRUAzaRG8w8oO4neDYpCB1np6qmQmNyDXjoRB+B6dDQN24O9UbXdWz5Pu9jvE47RqwozaftugUmgW/uikTs81rqFRV9hck9FOfaGODO6Bppf0L5jSsk9fvUGXvYeBZvq4ipZHOBvqUFRjblCVV0EVewAhlwc9Z4z42sXFJCCLz4zDCYOFLsYWkc=
      - secure: A0EyBrCJYGHnCAfzzAupoFz2K96rHB4aJmq3tQZ/W1nllxh0eW0jNEXyAGZG13NLxACw9U7oxM1FAuKTZoKQ9XxeJ0D7jMQjtVBWoDQlB1prK8L+NkHNWCt5KkJ3vtx3Wn9GDWmxCnPyKi+FkaartPPuR+12oAawCWyX/LRg0eHMTTgvb6xtGEvUAdkF4ocO4I9vFsiJLu5vXaavgGCUJJVelIXV8zkXpLE//4Fm1DOuiJGB+EMhpEsACgW++DpTAtVqmFaCh12c4vWsvC0JyrpFe2Oe6Q1nbrEQtNxHMTRCJht3VBKYcuLdxq+az2xZUizU9YlCuOgxsqTxw0YXehMlIIl8MdIGWK1PccGouvTCB5Qzsv6MzF5LMp/GvechRDLwMd5xWhqXWhmHJfmn1XXCUv6RwrX9RSfrclWTUQMCknNWkP2GpSnkJqTvZ8CyiZMyahiJZC5OhnM/vYYl5FSACxs5vYaMZvz7hnr8YktwOGRK60RSD+SXnef+S3D6rLtTfkuZSUsK1gUjLziz3Bviz3JXOTKLH3HN0BWuQ0jawS2DnbvV99OYLOjjklGP8xU2FWGMjQiwX9arux8jsNU1Xss+F2yB2ElVuh+L93kn/WviD+Au0GNH4OdXVa8sXBXi+L7BMKi++hbcV+4hl1hhaglmAS9AtSHrlggi6aQ=
      - secure: piCzL83qx3K9TizHqrOzgJCgbIpV2yhOYaYzCF9SXdeKTUIEPYi2jsbEJ5AzaTggyeXd/qqqfIeMuWHyIuWQtN+eTk9XeHR+s8QCeLAe1vvygq4NZcIGs5i2/9BYVkTpTR4kTnUut5FTUcthTFLI8fxpSAqWEE0JCj6eHKO9I6RFgpmN2HI6nihu9Wsu6PKBD8z8n1/Zj8x+iDtdTSlGTVPWEypfYzPzi+0tNEl5MpxV08niQZqKE0yIlbEXp5/fAMsOP3zlv8z9t52A11zmfvfXY22YdC3yw7ZKsPQ2QFUzNKkEBEJDkMXBEYMW7SgWMtc3GnBI98NJbJ83OkrebTCigcy9QBT7xYEcxqKknpdnT5yRpfJq8KrtrvbA6eCBPDUnYkMK5Vch1sUSDfvmBXEBG66ADbXVrKZCZMZBHs8p0QJon1wZIN7xMRYURhhT3gjuohgeNYyfLUuRq1uOZbQXcEZMgNrTfKzPuTJ3sRYxQB1XNgSVB9ByCGhx9W2/uKuJ9b2Gznab8oR3QX0lLOBfWiko05p4KHfEvIdGezD+pKZpma1GGKtNuC7NQf1mp+EVsh2+ULUL9QmsZgZmDL3AbR2XjFWjR9OdBFLNcsV3kxu2bcJSX4plOU1coZkh2jAYlEmbwcdLbKVc4Tc5fvjnIQUUvpZh+r6GnR+/u0s=
      - secure: L2Yesk9kHmvgEVQ8T4g7g0sKC+7daKZvyuzM9ubHUeKgAho+fXz9Y8QBYugmh02K79luzRBsL8Qa4bisrbF/JUr6psNbSpgAhNHvOto8Iw+0L8MlFFUw2MSkuxdK9DnWZEMdKt7D4y6q3Px8aSi+eHepnK+ZvGys1SDC2eXfr1hDyLplCIBJXZYNDLw3dUwU3wk4zejSVxeYYwDxu9JjidzQ3vgsJ9XD+7UjnN2t8x8XirnmcNWvCh2fbMdpXsVsdp+Pf6JaC9y/L9yUKPmm25t2bvtbRgWxA2pLlGdLXjmYMlZR940PCHZEZi+TIdJ1dHQIkLDHQMjwQzB10FGNUOPYRZK3dWiPoem4uTIMM8ORrL9C2E/pwPYAUKzaIfJXs03MQtiu51yEcPsOsXwBnsmaBcvZV8pbtmBQOlDzLPNNd8LiEFBEd2Br2VxUJvDwwoyviEQoBigcU7uyi+AcX6EsZ+uGh/TjEcc4JzwIehj/hTyrDmVF1j/69IH37oPAqabCDfkWjISycPPeMmTwldivH25w9E/HvS24ZEdw9or5ES/u4Tam7Kbfm4eGAUS+GX1scEtLrLt/wcm2bTIV87FTIIgPKVTFI6OaOcV4BCmUq3NrnfG5Dko80zMJ0wB+2S5RRq8UMK2LSuuQms7cImtfZrNpa/n9d6UUYblkYsA=
      - secure: jCpD5FXTHW/lUyrtrT+744aBq5mj15tfBhtBuwbFVIWdGh5XfKH+Ee+f8ErTtPq7f0j5yzgdz3jo6sgYG4zQctc2N5Cmg10HltSwCNd28TK/V6ySqcjk5YEpjgoQH216hPn3WjiZsnT7gAEVOFV/T7Op+Zoh+JQ6unW4IvJycxhrWKrXfmU4RIr7ul/Sk/KiGrCjdoSElyVnxJMH1jgiUONXBEybTR8uduxASkHmgbBU69xkUzgPJDc9x2juPI5bes69r2fADmtC8+X9J6S0GQq9FLb0jaSVF8iYU0eXOd2bcvjzsPqJz142GxtNTHbbVsHWLj3qNamxTHkQ016wMsCihTstIMUoexxxxrffKidCVME0sWUlCrnnmkcSxUWjJwF6Q6D5yajQy9ZiA0azy5zYwq5Oe827659vFGXxnoKf1d0QqoEyzUDiBXC6PqxoMgDo8zdd6PWWiUJtB/CwgYNrp/9yBb8yU1znBP7jq5f6oaufzSFPYvGlXyFMbOmm7ATaJswKPJy+QjNkAlj81uizbjMOdOE2bkVC8Hbu2Im0F/OEgRroE7WRefJjIBO36Zg/DyUFrCRfpg2yHTog17Y18BemXgtga0bfZkPk3PX6jE6D5JU976gWDmTfcGfduUn62tznxvHMQbfwPZVj4orQLtTk17ZGsszLviEeLHY=
      - secure: XQnN/O10kWHr6Z3Ixp2zlBmbR8hZ058X7oV5CKBnyeQYsY4/KTJnotwOGkHbfOZT2BCfgQvf8YqwNOoALwm5aWS2Mwzo5yJTHkthK7rP5/zRgNGczavNGAoN6sJcHnuChdaTNsHfNRa+Oo7OwoQitb0drFTE2oLUC6UbsXhf/0Gqew+YtCjh9SDDupRDiM6OqZKExenIFMeFGyST42br2xYyGZkyNtzY1WRV0mdznmBe+MFRU72HlvIF+82nODcFtonjQjwHnWaXinrb2tGQZGX0NwFJU5fap/VWYMa2D5nXmPloitpkIOTq/p5CoHKVEi605fIy0Xd/j2iiSpOYX5se6ctXInub+x/ZlVpuLp15bplfGDhxSRWi1gaiAIPSuZVMx8lo9hivJ0c2VVQT3aNy+AuyURAwFCY8E9jXfy9SLfmsV1wCEqaUARyT1Cg/E1U0qFOBUxnKG5d262VaPk/tmd1lGih0HslNKicPlNSUlAVIe77+cGEbxCvts2Ayl6s34xJGvecGOk+crXdLCof0YMkRW4vZbqr8xGJVu+CRSyjtkBla13vgp6xxXASw61/6XBT5+6kEtUSbsy/JSNaHh9RxVd9qgizasU2xOhGVOHb6csVz0pqNXqE5SRDEqbYIkS2X+YTRFGcEnukLGzPwLZqT64a7MFwA02DoWJM=
      - secure: JiNM+YXuuTKYKvSL2kvsNLngFxxYaHD7Nr4K7SBDrrbP5+ILzs74OQoNdLCr14sm5qGcA1OizGEaxwWKJXqeXZ+BQ4eJPuTp2CAXa6PFmrv/TimWV9XwmhOeVsEoq5RjScPJh5VZ8bfMsEM3bEUNIU+8Jesyz7GoiK4F4hfgy1E5uhqPq1ZIG3NfCNOgo27te+0CO1vnmUs0wEIdQWCafO/Y2T5lqrVlUaGI+eQzL0d8ohK1Y+Y5ZisePz4qgQ3umDXF/9AKl5HqHosCUY4pEXYgBSmnbldIjkabB/0983MetFcsvtGWEYoQD8EvHw+i43ppd2bIm9Q1Mep2mtp8aZsF5Tg2WOcWM9zekiJ/QipHMBMkpTGK15Tbjw/7YGLcyUVTK7aaK7KbrTl504wO+J6g77KFBEDYhDChAMpRaNfCIDnlkwNpsGNQSDLOaVgDS2b+UT4OwvFGwnB8/ytJSFHmyWMN7atB/6hCpLTUm60Foip0buXQmONCDUsj3RNy4X9DjrMHOkcQMXDjtu6HDRP+zkcbWBadUJfM7fxw8LZtBY0luyUzLCm67fuD1jYiJHrt5zwg4A4XsmzPinfUsu1jIOizQv81ww2+OM3j/bxGC1/oj5kbhyD8n57Ltdt7YzzRevXGowaiYWm6ySqrRKNxRX4y2sISvNM7IWmrqcs=
    script:
      - export GO111MODULE=on
      - make test-cover
      - goveralls -coverprofile=cover.out -service=travis-ci
script:
  - export GO111MODULE=on
  - make

